@model IEnumerable<KidShop.ViewModel.CommentStatisticVM>

<div class="content-body">
    <div class="container-fluid">

        <div class="pagetitle mb-4">
            <h2>💬 Danh sách bình luận</h2>
        </div>

        <!-- Thống kê nhanh -->
        <div class="alert alert-info text-center mb-4 shadow-sm">
            🛍️ Sản phẩm: <strong>@ViewBag.TotalProduct</strong> |
            📝 Bài viết: <strong>@ViewBag.TotalBlog</strong> |
            🎬 Video: <strong>@ViewBag.TotalVideo</strong>
            🎓 Khóa học: <strong>@ViewBag.TotalCourse</strong>
        </div>
        <!-- Form tìm kiếm -->
        <form method="get" class="mb-3">
            <div class="input-group">
                <input type="text" name="search" value="@ViewBag.Search" class="form-control" placeholder="Tìm kiếm email..." />
                <button class="btn btn-primary" type="submit">Tìm</button>
            </div>
        </form>
        <!-- Bộ lọc -->
        <form method="get" class="d-flex justify-content-start mb-3">
            <select name="type" class="form-select w-auto" onchange="this.form.submit()">
                <option value="">-- Tất cả loại --</option>
                <option value="Product" selected="@(ViewBag.SelectedType == "Product")">Sản phẩm</option>
                <option value="Blog" selected="@(ViewBag.SelectedType == "Blog")">Bài viết</option>
                <option value="Video" selected="@(ViewBag.SelectedType == "Video")">Video</option>
                <option value="Course" selected="@(ViewBag.SelectedType == "Course")">Khóa học</option>
            </select>
        </form>

        <!-- Thông báo -->
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success">@TempData["SuccessMessage"]</div>
        }

        <!-- Bảng bình luận -->
        <div class="card shadow-sm rounded-3">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-striped align-middle">
                        <thead class="table-dark text-center">
                            <tr>
                                <th style="width:50px;">#</th>
                                <th>Email</th>
                                <th>Nội dung</th>
                                <th>Loại</th>
                                <th>Ngày tạo</th>
                                <th>Trạng thái</th>
                                <th style="width:90px;">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.Any())
                            {
                                int index = 1;
                                foreach (var c in Model)
                                {
                                    <tr>
                                        <td class="text-center">@index</td>
                                        <td>@c.Email</td>
                                        <td>@c.Contents</td>
                                        <td class="text-center">
                                            @if (c.TargetType == "Product")
                                            {
                                                <span class="badge bg-primary">Sản phẩm</span>
                                            }
                                            else if (c.TargetType == "Blog")
                                            {
                                                <span class="badge bg-success">Bài viết</span>
                                            }
                                            else if (c.TargetType == "Video")
                                            {
                                                <span class="badge bg-warning text-dark">Video</span>
                                            }
                                            else if (c.TargetType == "Course")
                                            {
                                                <span class="badge bg-info text-dark">Khóa học</span>
                                            }
                                        </td>
                                        <td class="text-center">@c.CreatedDate?.ToString("dd/MM/yyyy HH:mm")</td>
                                        <td class="text-center">
                                            @if (c.IsActive)
                                            {
                                                <span class="badge bg-success">Hiển thị</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary">Ẩn</span>
                                            }
                                        </td>
                                        <td class="text-center">
                                            <form asp-action="Delete" asp-route-id="@c.CommentID" method="post" onsubmit="return confirm('Bạn có chắc muốn xóa bình luận này không?');">
                                                <button type="submit" class="btn btn-sm btn-danger">
                                                    <i class="fa fa-trash"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                    index++;
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="7" class="text-center text-muted">Không có bình luận nào.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <!-- Phân trang -->
                <nav>
                    <ul class="pagination justify-content-center mt-3">
                        @for (int i = 1; i <= ViewBag.TotalPages; i++)
                        {
                            <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                                <a class="page-link" href="?search=@ViewBag.Search&page=@i">@i</a>
                            </li>
                        }
                    </ul>
                </nav>
            </div>
        </div>

    </div>
</div>